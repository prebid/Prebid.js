<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Prebid.js video adUnit example</title>

  <link rel="stylesheet" href="http://vjs.zencdn.net/5.9.2/video-js.css">
  <script type="text/javascript" src="http://vjs.zencdn.net/5.9.2/video.js"></script>

  <!-- videojs-vast-vpaid -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs.vast.vpaid.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs_5.vast.vpaid.min.js"></script>

  <style type="text/css">
    .description {
      background-color:#eee;
      border: 1px solid #777;
      padding: 10px;
      font-size: .8em;
      line-height: 1.5em;
      font-family: Verdana, sans-serif;
    }
    .example-video-container {
      display: inline-block;
    }
  </style>
  <script src="/build/dev/prebid.js" async=true></script>
    <script>

        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];

        /*
         Prebid Video adUnit
         */

        var videoAdUnit = {
            code: 'video1',
            sizes: [640,480],
            mediaTypes: {
                video: {context: 'instream',  playerSize: [640, 480]}
            },
            bids: [
                {
                    bidder: 'appnexus',
                    params: {
                        placementId: '9333431',
                        video: {
                            skipppable: false,
                            playback_methods: ['auto_play_sound_off']
                        }
                    }
                }
            ]
        };

        pbjs.que.push(function(){
            pbjs.addAdUnits(videoAdUnit);
            pbjs.requestBids({
                timeout : 700,
                bidsBackHandler : function(bids) {
                        console.log(bids)
                        var videoUrl = pbjs.adServers.dfp.buildVideoUrl({
                        adUnit: videoAdUnit,
                        params: {
                            iu: '/19968336/prebid_cache_video_adunit'
                        }
                    });

                    invokeVideoPlayer(videoUrl);
                }
            });
        });

        pbjs.bidderSettings =
            {
                standard: {
                    adserverTargeting: [
                        {
                            key: "hb_bidder",
                            val: function (bidResponse) {
                                return bidResponse.bidderCode;
                            }
                        }, {
                            key: "hb_adid",
                            val: function (bidResponse) {
                                return bidResponse.adId;
                            }
                        }, {
                            key: "hb_pb",
                            val: function (bidResponse) {
                                return "10.00";
                            }
                        }, {
                            key: "hb_size",
                            val: function (bidResponse) {
                                return bidResponse.size;

                            }
                        }
                    ]
                }
            };
    </script>
</head>
<body>

  <div class="example-video-container">
    <video id="vid1" class="video-js vjs-default-skin" autoplay controls preload="auto"
        poster="http://video-js.zencoder.com/oceans-clip.png"
        data-setup='{}'
        width='640'
        height='480'
        >
      <source src="http://vjs.zencdn.net/v/oceans.mp4" type='video/mp4'>

      <p>Video Playback Not Supported</p>
    </video>
  </div>

  <script>
    /*
    This function called after prebid is back
     */
    function invokeVideoPlayer(url) {
        videojs("vid1").ready(function() {
            this.vastClient({
                adTagUrl: url,
                playAdAlways: true,
                verbosity: 4,
                vpaidFlashLoaderPath: "https://github.com/MailOnline/videojs-vast-vpaid/blob/RELEASE/bin/VPAIDFlash.swf?raw=true",
                autoplay: true
            });

            this.muted(true);
            this.play();
        });

    }
  </script>

</body>
</html>
