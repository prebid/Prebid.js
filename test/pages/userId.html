<!-- This is a Test Page for a Banner End-to-End test  -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Prebid.js Banner Example</title>

    <!-- Prebid.js -->
    <script async
            src="http://localhost:4444/bundle?modules[]=adtelligentBidAdapter&modules[]=userId&modules[]=criteoIdSystem&modules[]=pubProvidedIdSystem"></script>

    <!-- Google Publisher Tag -->
    <script async src="https://www.googletagservices.com/tag/js/gpt.js"></script>

    <script>
      var pbjs = pbjs || {};
      pbjs.que = pbjs.que || [];

      // Prebid Banner Ad Unit
      const adUnits = [{

        type: 'display',
        code: 'div-gpt-ad-1460505748561-0',
        mediaTypes: {
          banner: {
            sizes: [[300, 250]]
          }
        },
        bids: [{
          bidder: 'adtelligent',
          params: {
            aid: 350975,
            placementId: 'Billboard_Top',
            divId: 'Billboard_Top_3c5425', // optional parameter
            pageTemplate: 'home', // optional parameter
            badv: ['example.com'], // optional parameter
            bcat: ['IAB1-1', 'IAB1-2'], // optional parameter
            bapp: ['com.blocked'], // optional parameter
            battr: [1, 2] // optional parameter
          }
        }]
      }
      ];
    </script>

    <script>
      var googletag = googletag || {};
      googletag.cmd = googletag.cmd || [];

      googletag.cmd.push(function () {
        googletag.pubads().disableInitialLoad();
      });

      pbjs.que.push(function () {

        pbjs.setConfig({
          userSync: {
            userIds: [
              {
                name: 'criteo',
                storage:{
                  type:'html5',
                  name:'criteo_id'
                }
              }
            ]
          }
        })
        pbjs.setConfig({
          userSync: {
            userIds: [
              {
                name: 'pubProvidedId',
                params:{
                  eids:[{
                    source: "domain.com",
                    uids: [{
                      id: "value read from cookie or local storage",
                      atype: 1,
                      ext: {
                        stype: "ppuid"
                      }

                    }]
                  }]
                }
              }
            ]
          }
        })
        // pbjs.refreshUserIds();
        pbjs.addAdUnits(adUnits);

        pbjs.requestBids({ bidsBackHandler: sendAdServerRequest });
        setInterval(() => pbjs.requestBids({ bidsBackHandler: sendAdServerRequest }), 5000)
      });

      function sendAdServerRequest() {
        googletag.cmd.push(function () {
          pbjs.que.push(function () {
            pbjs.setTargetingForGPTAsync('div-gpt-ad-1460505748561-0');
            googletag.pubads().refresh();
          });
        });
      }
    </script>

    <script>
      googletag.cmd.push(function () {
        googletag
          .defineSlot('/19968336/header-bid-tag-0', [[300, 250], [300, 600]], 'div-gpt-ad-1460505748561-0')
          .addService(googletag.pubads());

        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
      });
    </script>
</head>

<body>
<h2>Prebid.js Banner Ad Unit Test</h2>
<div id='div-gpt-ad-1460505748561-0'>
    <script>
      googletag.cmd.push(function () {
        googletag.display('div-gpt-ad-1460505748561-0');
      });
    </script>
</div>
<div id="targeting-keys"></div>
</body>

</html>
