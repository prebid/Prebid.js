// import or require modules necessary for the test, e.g.:
import { expect } from 'chai'; // may prefer 'assert' in place of 'expect'
import { spec } from 'modules/brainxBidAdapter.js';
import utils, { deepClone } from '../../../src/utils';
// import adapter from 'src/adapters/<adapter>';
import { BANNER, NATIVE, VIDEO } from 'src/mediaTypes.js';

describe('Brain-X Aapater', function () {
  describe('isBidRequestValid', function () {
    it('undefined bid should return false', function () {
      expect(spec.isBidRequestValid()).to.be.false;
    });

    it('null bid should return false', function () {
      expect(spec.isBidRequestValid(null)).to.be.false;
    });

    it('bid.params should be set', function () {
      expect(spec.isBidRequestValid({})).to.be.false;
    });

    it('bid.params.pubId should be set', function () {
      expect(spec.isBidRequestValid({
        params: { pubId: 'F7B53DBC-85C1-4685-9A06-9CF4B6261FA3', endpoint: 'http://adx-engine-gray.tec-do.cn/bid' }
      })).to.be.false;
    });
  })

  // describe('isBidRequestValid', function () {
  //   it('Test the banner request processing function', function () {
  //     const request = spec.buildRequests(bannerRequest, bannerRequest[0]);
  //     expect(request).to.not.be.empty;
  //     const payload = request.data;
  //     expect(payload).to.not.be.empty;
  //   });
  //   it('Test the video request processing function', function () {
  //     const request = spec.buildRequests(videoRequest, videoRequest[0]);
  //     expect(request).to.not.be.empty;
  //     const payload = request.data;
  //     expect(payload).to.not.be.empty;
  //   });
  //   it('Test the param', function () {
  //     const request = spec.buildRequests(bannerRequest, bannerRequest[0]);
  //     const payload = JSON.parse(request.data);
  //     expect(payload.imp[0].tagid).to.eql(videoRequest[0].params.tagid);
  //     expect(payload.imp[0].bidfloor).to.eql(videoRequest[0].params.bidfloor);
  //   });
  // })

  describe('interpretResponse', function () {
    it('Test banner interpretResponse', function () {
      const serverResponse = {
        body: {
          'bidid': 'a82042c055b04e539ec6876112c10ced1729663902983',
          'cur': 'USD',
          'id': '28f8f1f525372a',
          'seatbid': [
            {
              'bid': [
                {
                  'adid': '76797',
                  'adm': "<div>\n  <img src=\"https://adx-event-server.bidtrail.top/impression?s=Eid0ZWMxNDk4NDQzODk3MjcwOTU1MzAwNzM3YjczMTQwMTA4ODk5ODQaDjI4ZjhmMWY1MjUzNzJhIKkCKgbmtYvor5U6DmxvY2FsaG9zdDo5OTk5Qgl1bmRlZmluZWRKA0hLR1ADYAFoAXADeAOAAQKKAQpjb20udGFvYmFvlQEX2U49nQEX2U49pQEX2U49ugEqCO4HEiUI7gcSCFRlY2RvRFNQGA01F9lOPTgBQBVKC1RlY2RvRFNQX1NHwAHuB8gBjcqCwKsy0AED-gGbAmh0dHBzOi8vbm90aWNlLXNnLmJpZHRyYWlsLnRvcC93aW4_YmlkX2lkPWE4MjA0MmMwNTViMDRlNTM5ZWM2ODc2MTEyYzEwY2VkMTcyOTY2MzkwMjk4MyZjYW1wYWlnbl9pZD00MjgmYWRfZ3JvdXBfaWQ9OTc2MSZhZF9pZD03Njc5NyZjcmVhdGl2ZV9pZD02NTI2JmFmZmlsaWF0ZV9pZD0yOTcmYnVuZGxlPSZmaXJzdF9zc3A9YnJhaW54LnRlY2gmcHVibGlzaF9pZD0mb3M9QW5kcm9pZCZ0YWdfaWQ9dW5kZWZpbmVkJmJpZF9zdWNjZXNzX3ByaWNlPTAuMDUwNSZzaWduPWUzODQyNjhiYzAzYzhmYmOSAgp0YW9iYW8uY29togILYnJhaW54LnRlY2ioAgGyAgdhbmRyb2lkwAICygICc2fQAgHYAo3hlcWrMuACjeGVxasy&v=h-6_6EmT2WPQ2FUuLsBJ9DX7uQM&auction_price=${AUCTION_PRICE}\" style=\"display:none\"/>\n</div>\n<div id=\"fc_dsp_banner_wrap\" style=\"width: 100%; height: 100%; overflow: hidden\">\n    <img id=\"fc_dsp_banner_img\"\n         src=\"https://creative.bidtrail.top/png/2/20f24c10f21e/091b422e3014033e57acffcf2a5c71dbb17383ec15ac9421\" border=\"0\"\n         style=\"max-width: 100%; max-height: 100%; position: absolute; top: 0; left: 0; right: 0; bottom: 0; margin: auto\"/>\n    \n    <div id=\"fc_dsp_banner_imp\"><img src=\"https://notice-sg.bidtrail.top/imp?bid_id=a82042c055b04e539ec6876112c10ced1729663902983&campaign_id=428&ad_group_id=9761&ad_id=76797&creative_id=6526&device_id=00000000-0000-0000-0000-000000000000&affiliate_id=297&id_key=7ae84957afc6a3c7e1ab1a7570b4798f&bundle=&first_ssp=adx-inner.com&publish_id=&os=Android&tag_id=undefined&ip=202.100.48.46&bid_success_price=0.0505&sign=e384268bc03c8fbc\" style=\"display:none\"/></div>\n</div>\n<script type=\"text/javascript\" id=\"fc_dsp_private_code\">\n    var _0x338d = ['mraid_exist', 'string', 'parse', '[object\\x20Array]', 'prototype', 'toString', 'call', 'indexOf', 'frameElement', 'getAttribute', 'sandbox', 'mraid', 'userAgent', 'webdriver', 'name', 'description', 'filename', 'version', 'join', 'keys', 'forEach', 'mimeTypes', 'type', 'unknow', 'callPhantom', '_phantom', 'phantom', '__nightmare', '_Selenium_IDE_Recorder', '_selenium', '__webdriver_script_fn', '__driver_evaluate', '__selenium_evaluate', '__driver_unwrapped', '__fxdriver_unwrapped', '__webdriver_script_func', 'selenium', 'driver', 'canvas', 'getContext', 'webgl', 'experimental-webgl', 'getSupportedExtensions', 'WEBGL_debug_renderer_info', 'getExtension', 'getParameter', 'UNMASKED_RENDERER_WEBGL', 'Not\\x20supported', 'error', 'measureText', 'function', 'getImageData', 'toDataURL', 'mediaDevices', 'enumerateDevices', 'bound\\x20reportBlock', 'kind', 'micros', 'videoinput', 'span', 'textContent', 'font-family', 'font-weight', 'Chrome', 'undefined', 'runtime', 'exec', 'sendMessage', 'chrome://version', 'match', 'devToolsVersion', 'collect_feature', 'getElementsByTagName', 'script', 'outerHTML', 'fc_dsp_private_code', 'open', 'POST', 'setRequestHeader', 'Content-type', 'stringify', 'application/json', '&type=', '&error=', 'src', 'img', 'atob', 'display:none', 'addEventListener', 'load', 'fc_dsp_banner_img', 'onclick', 'https://click.tracksummer.com/aff_c?offer_id=176495382&affiliate_id=14382', 'https://notice-sg.bidtrail.top/collect/code?bid_id=a82042c055b04e539ec6876112c10ced1729663902983&affiliate_id=297&ad_group_id=9761&bundle=&ip=202.100.48.46&schain=adx-inner.com&device_id=00000000-0000-0000-0000-000000000000', 'https://notice-sg.bidtrail.top/collect/feature?bid_id=a82042c055b04e539ec6876112c10ced1729663902983&affiliate_id=297&ad_group_id=9761&bundle=&ip=202.100.48.46&schain=adx-inner.com&device_id=00000000-0000-0000-0000-000000000000', 'https://notice-sg.bidtrail.top/collect/error?bid_id=a82042c055b04e539ec6876112c10ced1729663902983&affiliate_id=297&ad_group_id=9761&bundle=&ip=202.100.48.46&schain=adx-inner.com&device_id=00000000-0000-0000-0000-000000000000', '', '', 'Microsoft.XMLHTTP', 'create_http', 'message', 'location', 'href', 'GET', 'send', 'iframe', 'width', 'style', 'display', 'none', 'getElementById', 'fc_dsp_banner_wrap', 'compatMode', 'clientWidth', 'body', 'clientHeight', 'offsetLeft', 'offsetParent', 'offsetTop', 'documentElement', 'getBoundingClientRect', 'createElement', 'div', 'cssText', 'position:absolute;left:0;top:0;', 'appendChild', 'removeChild', 'offset', 'left', 'right', 'top', 'offsetWidth', 'offsetHeight', 'from', 'all', 'getComputedStyle', 'getPropertyValue', 'z-index', 'push', 'length', 'user_agent', 'mime_types', 'platform', 'phantom_js_features', 'nightmare_js', 'selenium_features', 'web_rtc', 'fonts', 'cdp'];\n    (function (_0x206a4b, _0x19bf97) {\n        var _0x5bfbaa = function (_0x29d206) {\n            while (--_0x29d206) {\n                _0x206a4b['push'](_0x206a4b['shift']());\n            }\n        };\n        _0x5bfbaa(++_0x19bf97);\n    }(_0x338d, 0x186));\n    var _0x2791 = function (_0x3ead8e, _0x2ba72e) {\n        _0x3ead8e = _0x3ead8e - 0x0;\n        var _0x123872 = _0x338d[_0x3ead8e];\n        return _0x123872;\n    };\n    var e = [\"https://notice-sg.bidtrail.top/click?bid_id=a82042c055b04e539ec6876112c10ced1729663902983&campaign_id=428&ad_group_id=9761&ad_id=76797&creative_id=6526&device_id=00000000-0000-0000-0000-000000000000&affiliate_id=297&id_key=7ae84957afc6a3c7e1ab1a7570b4798f&bundle=&sign=e384268bc03c8fbc\"], t = _0x2791('0x0'), n = _0x2791('0x1'), r = _0x2791('0x2'), o = _0x2791('0x3'),\n        i = [\"Z2VvZWRnZQ==\"], a = _0x2791('0x4'), u = _0x2791('0x5');\n\n    function c() {\n        var _0x5b49ed;\n        try {\n            _0x5b49ed = new XMLHttpRequest();\n        } catch (_0x5ecd1d) {\n            try {\n                _0x5b49ed = new ActiveXObject('Msxml2.XMLHTTP');\n            } catch (_0x4c950c) {\n                try {\n                    _0x5b49ed = new ActiveXObject(_0x2791('0x6'));\n                } catch (_0x53fbda) {\n                    _0x5b49ed = !0x1, y(_0x2791('0x7'), _0x53fbda[_0x2791('0x8')]);\n                }\n            }\n        }\n        return _0x5b49ed;\n    }\n\n    function d() {\n        s(), window[_0x2791('0x9')][_0x2791('0xa')] = t;\n    }\n\n    function s() {\n        for (var _0x3ed8ce in e) {\n            var _0x55d070 = c();\n            if (_0x55d070) _0x55d070['open'](_0x2791('0xb'), e[_0x3ed8ce], !0x0), _0x55d070[_0x2791('0xc')](); else {\n                var _0x43f308 = document['createElement'](_0x2791('0xd'));\n                _0x43f308['height'] = 0x1, _0x43f308[_0x2791('0xe')] = 0x1, _0x43f308[_0x2791('0xf')][_0x2791('0x10')] = _0x2791('0x11'), _0x43f308['src'] = e[_0x3ed8ce], document[_0x2791('0x12')](_0x2791('0x13'))['appendChild'](_0x43f308);\n            }\n        }\n    }\n\n    function m() {\n        return 'BackCompat' == document[_0x2791('0x14')] ? {\n            'width': document['body'][_0x2791('0x15')],\n            'height': document[_0x2791('0x16')][_0x2791('0x17')]\n        } : {\n            'width': document['documentElement'][_0x2791('0x15')],\n            'height': document['documentElement'][_0x2791('0x17')]\n        };\n    }\n\n    function f(_0x5e4030) {\n        for (var _0x3b1a31 = _0x5e4030[_0x2791('0x18')], _0x10e390 = _0x5e4030[_0x2791('0x19')]; null !== _0x10e390;) _0x3b1a31 += _0x10e390['offsetLeft'], _0x10e390 = _0x10e390[_0x2791('0x19')];\n        return _0x3b1a31;\n    }\n\n    function l(_0x109f8b) {\n        for (var _0x28d3f5 = _0x109f8b[_0x2791('0x1a')], _0x2a053e = _0x109f8b[_0x2791('0x19')]; null !== _0x2a053e;) _0x28d3f5 += _0x2a053e['offsetTop'], _0x2a053e = _0x2a053e['offsetParent'];\n        return _0x28d3f5;\n    }\n\n    var p = function e(_0x2ec758) {\n        var _0x1cc023 = document[_0x2791('0x1b')]['scrollTop'], _0xe3eeb8 = document[_0x2791('0x1b')]['scrollLeft'];\n        if (_0x2ec758[_0x2791('0x1c')]) {\n            'number' != typeof e['offset'] && (e['offset'] = function () {\n                var _0x54a4da = document[_0x2791('0x1d')](_0x2791('0x1e'));\n                _0x54a4da[_0x2791('0xf')][_0x2791('0x1f')] = _0x2791('0x20'), document['body'][_0x2791('0x21')](_0x54a4da);\n                var _0x2ec758 = -_0x54a4da[_0x2791('0x1c')]()['top'] - _0x1cc023;\n                return document[_0x2791('0x16')][_0x2791('0x22')](_0x54a4da), _0x54a4da = null, _0x2ec758;\n            }());\n            var _0x408b14 = _0x2ec758[_0x2791('0x1c')](), _0x31964e = e[_0x2791('0x23')];\n            return {\n                'left': _0x408b14[_0x2791('0x24')] + _0x31964e,\n                'right': _0x408b14[_0x2791('0x25')] + _0x31964e,\n                'top': _0x408b14[_0x2791('0x26')] + _0x31964e,\n                'bottom': _0x408b14['bottom'] + _0x31964e\n            };\n        }\n        var _0x1db2e7 = f(_0x2ec758), _0x364f7f = l(_0x2ec758);\n        return {\n            'left': _0x1db2e7 - _0xe3eeb8,\n            'right': _0x1db2e7 + _0x2ec758[_0x2791('0x27')] - _0xe3eeb8,\n            'top': _0x364f7f - _0x1cc023,\n            'bottom': _0x364f7f + _0x2ec758[_0x2791('0x28')] - _0x1cc023\n        };\n    };\n\n    function v() {\n        var _0x45e336 = Array[_0x2791('0x29')](document[_0x2791('0x2a')]), _0x3ae2a9 = [];\n        _0x45e336['forEach'](function (_0x45e336) {\n            var _0x4292f7 = Number(window[_0x2791('0x2b')](_0x45e336, null)[_0x2791('0x2c')](_0x2791('0x2d')));\n            _0x4292f7 && _0x3ae2a9[_0x2791('0x2e')](_0x4292f7);\n        });\n        var _0x39d4e2 = 0x0;\n        return _0x3ae2a9[_0x2791('0x2f')] && (_0x39d4e2 = Math['max'](..._0x3ae2a9)), _0x39d4e2;\n    }\n\n    function _() {\n        var _0xb34f43 = {},\n            _0x40e6dc = ['iframe', 'keywords', 'iframe_sandbox', _0x2791('0x30'), 'web_driver', 'plugins', _0x2791('0x31'), _0x2791('0x32'), _0x2791('0x33'), _0x2791('0x34'), _0x2791('0x35'), 'web_gl', 'canvas', _0x2791('0x36'), _0x2791('0x37'), _0x2791('0x38'), _0x2791('0x39')],\n            _0x8fe471 = {\n                'iframe': function () {\n                    return null !== window['frameElement'];\n                }, 'keywords': function () {\n                    var _0xb34f43 = [];\n                    if (_0x2791('0x3a') == typeof i) _0xb34f43 = JSON[_0x2791('0x3b')](atob(i)); else if (_0x2791('0x3c') === Object[_0x2791('0x3d')][_0x2791('0x3e')][_0x2791('0x3f')](i)) for (let _0x40e6dc = 0x0; _0x40e6dc < i[_0x2791('0x2f')]; _0x40e6dc++) _0xb34f43[_0x2791('0x2e')](atob(i[_0x40e6dc]));\n                    var _0x40e6dc = g(), _0x8fe471 = !0x1;\n                    if ('' !== _0x40e6dc) for (let _0x3b34af = 0x0; _0x3b34af < _0xb34f43[_0x2791('0x2f')]; _0x3b34af++) if (-0x1 !== _0x40e6dc[_0x2791('0x40')](_0xb34f43[_0x3b34af])) return _0x8fe471 = !0x0;\n                    return _0x8fe471;\n                }, 'iframe_sandbox': function () {\n                    var _0xb34f43 = window[_0x2791('0x41')];\n                    return _0xb34f43 ? [_0xb34f43[_0x2791('0x42')](_0x2791('0x43'))] : [];\n                }, 'mraid_exist': function () {\n                    return _0x2791('0x44') in window;\n                }, 'user_agent': function () {\n                    return navigator[_0x2791('0x45')];\n                }, 'web_driver': function () {\n                    return navigator[_0x2791('0x46')];\n                }, 'plugins': function () {\n                    const _0xb34f43 = [];\n                    for (let _0x40e6dc = 0x0; _0x40e6dc < navigator['plugins']['length']; _0x40e6dc++) {\n                        const _0x8fe471 = navigator['plugins'][_0x40e6dc],\n                            _0x3b34af = [_0x8fe471[_0x2791('0x47')], _0x8fe471[_0x2791('0x48')], _0x8fe471[_0x2791('0x49')], _0x8fe471[_0x2791('0x4a')]][_0x2791('0x4b')]('::');\n                        let _0x3805f7 = [];\n                        Object[_0x2791('0x4c')](_0x8fe471)[_0x2791('0x4d')](_0xb34f43 => {\n                            _0x3805f7['push']([_0x8fe471[_0xb34f43]['type'], _0x8fe471[_0xb34f43]['suffixes'], _0x8fe471[_0xb34f43][_0x2791('0x48')]]['join']('~'));\n                        }), _0x3805f7 = _0x3805f7[_0x2791('0x4b')](','), _0xb34f43['push'](_0x3b34af + '__' + _0x3805f7);\n                    }\n                    return _0xb34f43;\n                }, 'mime_types': function () {\n                    const _0xb34f43 = [];\n                    for (let _0x40e6dc = 0x0; _0x40e6dc < navigator[_0x2791('0x4e')][_0x2791('0x2f')]; _0x40e6dc++) {\n                        let _0x8fe471 = navigator['mimeTypes'][_0x40e6dc];\n                        _0xb34f43['push']([_0x8fe471[_0x2791('0x48')], _0x8fe471[_0x2791('0x4f')], _0x8fe471['suffixes']]['join']('~~'));\n                    }\n                    return _0xb34f43;\n                }, 'platform': function () {\n                    return navigator[_0x2791('0x32')] ? navigator[_0x2791('0x32')] : _0x2791('0x50');\n                }, 'phantom_js_features': function () {\n                    return [_0x2791('0x51') in window, _0x2791('0x52') in window, _0x2791('0x53') in window];\n                }, 'nightmare_js': function () {\n                    return !!window[_0x2791('0x54')];\n                }, 'selenium_features': function () {\n                    return [_0x2791('0x46') in window, _0x2791('0x55') in window, 'callSelenium' in window, _0x2791('0x56') in window, _0x2791('0x57') in document, _0x2791('0x58') in document, '__webdriver_evaluate' in document, _0x2791('0x59') in document, '__fxdriver_evaluate' in document, _0x2791('0x5a') in document, '__webdriver_unwrapped' in document, '__selenium_unwrapped' in document, _0x2791('0x5b') in document, _0x2791('0x5c') in document, null !== document[_0x2791('0x1b')][_0x2791('0x42')](_0x2791('0x5d')), null !== document[_0x2791('0x1b')]['getAttribute'](_0x2791('0x46')), null !== document[_0x2791('0x1b')][_0x2791('0x42')](_0x2791('0x5e'))];\n                }, 'web_gl': function () {\n                    try {\n                        const _0xb34f43 = document[_0x2791('0x1d')](_0x2791('0x5f')),\n                            _0x40e6dc = _0xb34f43[_0x2791('0x60')](_0x2791('0x61')) || _0xb34f43['getContext'](_0x2791('0x62'));\n                        let _0x8fe471, _0x3b34af;\n                        return _0x40e6dc[_0x2791('0x63')]()[_0x2791('0x40')](_0x2791('0x64')) >= 0x0 ? (_0x8fe471 = _0x40e6dc['getParameter'](_0x40e6dc[_0x2791('0x65')](_0x2791('0x64'))['UNMASKED_VENDOR_WEBGL']), _0x3b34af = _0x40e6dc[_0x2791('0x66')](_0x40e6dc[_0x2791('0x65')](_0x2791('0x64'))[_0x2791('0x67')])) : (_0x8fe471 = _0x2791('0x68'), _0x3b34af = _0x2791('0x68')), {\n                            'webGLVendor': _0x8fe471,\n                            'webGLRenderer': _0x3b34af\n                        };\n                    } catch (_0x390e38) {\n                        return {'webGLVendor': _0x2791('0x69'), 'webGLRenderer': _0x2791('0x69')};\n                    }\n                }, 'canvas': function () {\n                    var _0x40e6dc = document[_0x2791('0x1d')](_0x2791('0x5f')),\n                        _0x8fe471 = _0x40e6dc[_0x2791('0x60')]('2d');\n                    return _0x8fe471 ? {\n                        'supportTextMetrics': 'function' == typeof _0x8fe471[_0x2791('0x6a')],\n                        'supportImageData': _0x2791('0x6b') == typeof _0x8fe471[_0x2791('0x6c')],\n                        'supportToDataURL': _0x2791('0x6b') == typeof _0x40e6dc[_0x2791('0x6d')]\n                    } : _0xb34f43;\n                }, 'web_rtc': function () {\n                    const _0xb34f43 = {'audiooutput': 0x0, 'audioinput': 0x0, 'videoinput': 0x0},\n                        _0x40e6dc = {'speakers': 0x0, 'micros': 0x0, 'webcams': 0x0};\n                    return navigator[_0x2791('0x6e')] && navigator[_0x2791('0x6e')][_0x2791('0x6f')] && _0x2791('0x70') !== navigator['mediaDevices'][_0x2791('0x6f')]['name'] ? (navigator['mediaDevices'][_0x2791('0x6f')]()['then'](_0x8fe471 => {\n                        if (void 0x0 !== _0x8fe471) {\n                            let _0x3b34af;\n                            for (let _0x40e6dc = 0x0; _0x40e6dc < _0x8fe471['length']; _0x40e6dc++) _0x3b34af = [_0x8fe471[_0x40e6dc][_0x2791('0x71')]], _0xb34f43[_0x3b34af] = _0xb34f43[_0x3b34af] + 0x1;\n                            _0x40e6dc['speakers'] = _0xb34f43['audiooutput'], _0x40e6dc[_0x2791('0x72')] = _0xb34f43['audioinput'], _0x40e6dc['webcams'] = _0xb34f43[_0x2791('0x73')];\n                        }\n                    }), _0x40e6dc) : navigator[_0x2791('0x6e')] && navigator[_0x2791('0x6e')]['enumerateDevices'] && _0x2791('0x70') === navigator[_0x2791('0x6e')][_0x2791('0x6f')]['name'] ? void (_0x40e6dc['devicesBlockedByBrave'] = !0x0) : _0x40e6dc;\n                }, 'fonts': function () {\n                    var _0xb34f43 = document[_0x2791('0x1d')](_0x2791('0x74'));\n                    _0xb34f43[_0x2791('0x75')] = 'font\\x20computed', document['body']['appendChild'](_0xb34f43);\n                    var _0x40e6dc = getComputedStyle(_0xb34f43),\n                        _0x8fe471 = _0x40e6dc[_0x2791('0x2c')](_0x2791('0x76')),\n                        _0x3b34af = _0x40e6dc['getPropertyValue']('font-size'),\n                        _0x27acb8 = _0x40e6dc[_0x2791('0x2c')](_0x2791('0x77'));\n                    return document[_0x2791('0x16')][_0x2791('0x22')](_0xb34f43), {\n                        'fontFamily': _0x8fe471,\n                        'fontSize': _0x3b34af,\n                        'fontWeight': _0x27acb8\n                    };\n                }, 'cdp': function () {\n                    var _0xb34f43 = {};\n                    if (-0x1 !== navigator[_0x2791('0x45')][_0x2791('0x40')](_0x2791('0x78')) && _0x2791('0x79') != typeof chrome && void 0x0 !== chrome[_0x2791('0x7a')]) {\n                        var _0x40e6dc = /Chrome\\/([0-9.]+)/[_0x2791('0x7b')](navigator['userAgent'])[0x1];\n                        chrome['runtime'][_0x2791('0x7c')]({'type': _0x2791('0x7d')}, _0x8fe471 => {\n                            var _0x3b34af = _0x8fe471[_0x2791('0x7e')](/DevTools\\ ([0-9.]+)/)[0x1];\n                            _0xb34f43[_0x2791('0x4a')] = _0x40e6dc, _0xb34f43[_0x2791('0x7f')] = _0x3b34af;\n                        });\n                    }\n                    return _0xb34f43;\n                }\n            }, _0x3b34af = {};\n        for (let _0xb34f43 = 0x0; _0xb34f43 < _0x40e6dc[_0x2791('0x2f')]; _0xb34f43++) {\n            let _0xe42193 = _0x40e6dc[_0xb34f43];\n            try {\n                _0x3b34af[_0xe42193] = _0x8fe471[_0xe42193]();\n            } catch (_0x40b02a) {\n                y(_0x2791('0x80'), _0x40b02a[_0x2791('0x8')]);\n            }\n        }\n        return _0x3b34af;\n    }\n\n    function g() {\n        for (var _0x530744 = '', _0x291bd0 = document[_0x2791('0x81')](_0x2791('0x82')), _0x448b56 = 0x0; _0x448b56 < _0x291bd0['length']; _0x448b56++) {\n            var _0x2c650b = _0x291bd0[_0x448b56][_0x2791('0x83')];\n            _0x2791('0x84') !== _0x291bd0[_0x448b56]['id'] && (_0x530744 += _0x2c650b);\n        }\n        return _0x530744;\n    }\n\n    function h() {\n        try {\n            var _0x3dfb63 = {'code': g()}, _0x201578 = c();\n            _0x201578 && (_0x201578[_0x2791('0x85')](_0x2791('0x86'), n, !0x0), _0x201578[_0x2791('0x87')](_0x2791('0x88'), 'application/json'), _0x201578[_0x2791('0xc')](JSON[_0x2791('0x89')](_0x3dfb63)));\n        } catch (_0x315b08) {\n            y('collect_script', _0x315b08[_0x2791('0x8')]);\n        }\n    }\n\n    function w() {\n        var _0x5457b3 = _(), _0x2aa4c9 = c();\n        _0x2aa4c9 && (_0x2aa4c9[_0x2791('0x85')](_0x2791('0x86'), r, !0x0), _0x2aa4c9[_0x2791('0x87')](_0x2791('0x88'), _0x2791('0x8a')), _0x2aa4c9['send'](JSON[_0x2791('0x89')](_0x5457b3)));\n    }\n\n    function y(_0x2bb9d7, _0x2fd7aa) {\n        var _0x1d937f = c();\n        if (_0x1d937f) _0x1d937f[_0x2791('0x85')](_0x2791('0xb'), o + (_0x2791('0x8b') + _0x2bb9d7 + _0x2791('0x8c') + _0x2fd7aa), !0x0), _0x1d937f[_0x2791('0xc')](); else {\n            var _0x31f941 = document[_0x2791('0x1d')](_0x2791('0xd'));\n            _0x31f941['height'] = 0x1, _0x31f941[_0x2791('0xe')] = 0x1, _0x31f941[_0x2791('0xf')][_0x2791('0x10')] = _0x2791('0x11'), _0x31f941[_0x2791('0x8d')] = o + (_0x2791('0x8b') + _0x2bb9d7 + _0x2791('0x8c') + _0x2fd7aa), document[_0x2791('0x16')][_0x2791('0x21')](_0x31f941);\n        }\n    }\n\n    function b() {\n        var _0x4a4fcf = document[_0x2791('0x1d')](_0x2791('0x8e'));\n        _0x4a4fcf[_0x2791('0x8d')] = decodeURIComponent(escape(window[_0x2791('0x8f')](a))), _0x4a4fcf[_0x2791('0xf')] = _0x2791('0x90'), a && document[_0x2791('0x16')][_0x2791('0x21')](_0x4a4fcf);\n    }\n\n    window[_0x2791('0x91')](_0x2791('0x92'), function () {\n        document[_0x2791('0x12')](_0x2791('0x93'))[_0x2791('0x94')] = d, b(), h(), w();\n    });\n</script><script>\n    function tecdoChangeURLArg_A(url, arg, arg_val) {\n    var pattern = arg +\n        '=([^&]*)';\n    var replaceText = arg + '=' + arg_val;\n    if (url.match(pattern)) {\n        var tmp = '/(' + arg\n            + '=)([^&]*)/gi';\n        tmp = url.replace(eval(tmp), replaceText);\n        return tmp;\n    } else {\n        if\n        (url.match('[\\?]')) {\n            return url + '&' + replaceText;\n        } else {\n            return url + '?' + replaceText;\n        }\n    }\n}\n\nfunction tecdoTracking_A(url) {\n    try {\n        navigator.sendBeacon(url);\n    } catch (error) {\n    }\n}\n\nfunction\ntecdoClickTracks_A(clkType) {\n    var urls =\n        \"https://adx-event-server.bidtrail.top/click?s=Eid0ZWMxNDk4NDQzODk3MjcwOTU1MzAwNzM3YjczMTQwMTA4ODk5ODQaDjI4ZjhmMWY1MjUzNzJhIKkCKgbmtYvor5U6DmxvY2FsaG9zdDo5OTk5Qgl1bmRlZmluZWRKA0hLR1ADYAFoAXADeAOAAQKKAQpjb20udGFvYmFvlQEX2U49nQEX2U49pQEX2U49ugEqCO4HEiUI7gcSCFRlY2RvRFNQGA01F9lOPTgBQBVKC1RlY2RvRFNQX1NHwAHuB8gBjcqCwKsy0AEE-gGbAmh0dHBzOi8vbm90aWNlLXNnLmJpZHRyYWlsLnRvcC93aW4_YmlkX2lkPWE4MjA0MmMwNTViMDRlNTM5ZWM2ODc2MTEyYzEwY2VkMTcyOTY2MzkwMjk4MyZjYW1wYWlnbl9pZD00MjgmYWRfZ3JvdXBfaWQ9OTc2MSZhZF9pZD03Njc5NyZjcmVhdGl2ZV9pZD02NTI2JmFmZmlsaWF0ZV9pZD0yOTcmYnVuZGxlPSZmaXJzdF9zc3A9YnJhaW54LnRlY2gmcHVibGlzaF9pZD0mb3M9QW5kcm9pZCZ0YWdfaWQ9dW5kZWZpbmVkJmJpZF9zdWNjZXNzX3ByaWNlPTAuMDUwNSZzaWduPWUzODQyNjhiYzAzYzhmYmOSAgp0YW9iYW8uY29togILYnJhaW54LnRlY2ioAgGyAgdhbmRyb2lkwAICygICc2fQAgHYAo3hlcWrMuACjeGVxasy&v=p972tkWIrH-FPbq9_M6paI85SX0\";\n    urls = urls.split(\",\");\n    for (var i = 0; i < urls.length; i++) {\n        var url =\n            tecdoChangeURLArg_A(urls[i], 'ct', clkType);\n        tecdoTracking_A(url);\n    }\n}\n\nvar tecdoClickHandler_A =\n    function () {\n        tecdoClickTracks_A(1)\n    }\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n    document.body.addEventListener('click', tecdoClickHandler_A);\n});\ndocument.addEventListener(\"unload\", function () {\n    document.body.removeEventListener('click',\n        tecdoClickHandler_A);\n})</script>\n",
                  'adomain': [
                    'taobao.com'
                  ],
                  'bundle': 'com.taobao',
                  'burl': 'https://adx-event-server.bidtrail.top/billing?s=Eid0ZWMxNDk4NDQzODk3MjcwOTU1MzAwNzM3YjczMTQwMTA4ODk5ODQaDjI4ZjhmMWY1MjUzNzJhIKkCKgbmtYvor5U6DmxvY2FsaG9zdDo5OTk5Qgl1bmRlZmluZWRKA0hLR1ADYAFoAXADeAOAAQKKAQpjb20udGFvYmFvlQEX2U49nQEX2U49pQEX2U49ugEqCO4HEiUI7gcSCFRlY2RvRFNQGA01F9lOPTgBQBVKC1RlY2RvRFNQX1NHwAHuB8gBjcqCwKsy0AEC-gGbAmh0dHBzOi8vbm90aWNlLXNnLmJpZHRyYWlsLnRvcC93aW4_YmlkX2lkPWE4MjA0MmMwNTViMDRlNTM5ZWM2ODc2MTEyYzEwY2VkMTcyOTY2MzkwMjk4MyZjYW1wYWlnbl9pZD00MjgmYWRfZ3JvdXBfaWQ9OTc2MSZhZF9pZD03Njc5NyZjcmVhdGl2ZV9pZD02NTI2JmFmZmlsaWF0ZV9pZD0yOTcmYnVuZGxlPSZmaXJzdF9zc3A9YnJhaW54LnRlY2gmcHVibGlzaF9pZD0mb3M9QW5kcm9pZCZ0YWdfaWQ9dW5kZWZpbmVkJmJpZF9zdWNjZXNzX3ByaWNlPTAuMDUwNSZzaWduPWUzODQyNjhiYzAzYzhmYmOSAgp0YW9iYW8uY29togILYnJhaW54LnRlY2ioAgGyAgdhbmRyb2lkwAICygICc2fQAgHYAo3hlcWrMuACjeGVxasy&v=P-1b7JJWs-uUQ68A37V4xDLplU0&auction_price=${AUCTION_PRICE}',
                  'cat': [
                    'IAB18-5'
                  ],
                  'cid': '428',
                  'crid': 'D06g1RVGMEnC+9Le4SZMJw==',
                  'h': 480,
                  'id': 'a82042c055b04e539ec6876112c10ced1729663902983',
                  'impid': '3c1dd9e1700358',
                  'iurl': 'https://creative.bidtrail.top/png/2/20f24c10f21e/091b422e3014033e57acffcf2a5c71dbb17383ec15ac9421',
                  'lurl': 'https://notice-sg.bidtrail.top/loss?bid_id=a82042c055b04e539ec6876112c10ced1729663902983&sign=e384268bc03c8fbc&campaign_id=428&ad_group_id=9761&ad_id=76797&creative_id=6526&affiliate_id=297&loss_code=${AUCTION_LOSS}',
                  'nurl': 'https://adx-event-server.bidtrail.top/winnotice?s=Eid0ZWMxNDk4NDQzODk3MjcwOTU1MzAwNzM3YjczMTQwMTA4ODk5ODQaDjI4ZjhmMWY1MjUzNzJhIKkCKgbmtYvor5U6DmxvY2FsaG9zdDo5OTk5Qgl1bmRlZmluZWRKA0hLR1ADYAFoAXADeAOAAQKKAQpjb20udGFvYmFvlQEX2U49nQEX2U49pQEX2U49ugEqCO4HEiUI7gcSCFRlY2RvRFNQGA01F9lOPTgBQBVKC1RlY2RvRFNQX1NHwAHuB8gBjcqCwKsy0AEB-gGbAmh0dHBzOi8vbm90aWNlLXNnLmJpZHRyYWlsLnRvcC93aW4_YmlkX2lkPWE4MjA0MmMwNTViMDRlNTM5ZWM2ODc2MTEyYzEwY2VkMTcyOTY2MzkwMjk4MyZjYW1wYWlnbl9pZD00MjgmYWRfZ3JvdXBfaWQ9OTc2MSZhZF9pZD03Njc5NyZjcmVhdGl2ZV9pZD02NTI2JmFmZmlsaWF0ZV9pZD0yOTcmYnVuZGxlPSZmaXJzdF9zc3A9YnJhaW54LnRlY2gmcHVibGlzaF9pZD0mb3M9QW5kcm9pZCZ0YWdfaWQ9dW5kZWZpbmVkJmJpZF9zdWNjZXNzX3ByaWNlPTAuMDUwNSZzaWduPWUzODQyNjhiYzAzYzhmYmOSAgp0YW9iYW8uY29togILYnJhaW54LnRlY2ioAgGyAgdhbmRyb2lkwAICygICc2fQAgHYAo3hlcWrMuACjeGVxasy&v=jFUg_b6F14d50JL-M6UE5Jc8VuA&auction_price=${AUCTION_PRICE}',
                  'price': 0.0505,
                  'w': 320
                }
              ],
              'group': 0,
              'seat': 'agency'
            }
          ]
        }
      };

      const bidResponses = spec.interpretResponse(serverResponse, {
        originalBidRequest: {
          auctionId: '3eedbf83-7d1d-423c-be27-39e4af687040',
          auctionStart: 1729663900819,
          adUnitCode: 'dev-1',
          bidId: '28f8f1f525372a',
          bidder: 'brainx',
          mediaTypes: { banner: { sizes: [[300, 250]] } },
          params: {
            pubId: 'F7B53DBC-85C1-4685-9A06-9CF4B6261FA3',
            endpoint: 'http://adx-engine-gray.tec-do.cn/bid'
          },
          src: 'client'
        }
      });

      expect(bidResponses).to.be.an('array').that.is.not.empty;

      const bid = serverResponse.body.seatbid[0].bid[0];
      const bidResponse = bidResponses[0];

      expect(bidResponse.mediaType).to.equal(BANNER);
      expect(bidResponse.requestId).to.equal(bid.impid);
      expect(bidResponse.cpm).to.equal(parseFloat(bid.price).toFixed(2))
      expect(bidResponse.currency).to.equal(serverResponse.body.cur);
      expect(bidResponse.creativeId).to.equal(bid.crid || bid.id);
      expect(bidResponse.netRevenue).to.be.true;
      expect(bidResponse.nurl).to.equal(bid.nurl);
      expect(bidResponse.lurl).to.equal(bid.lurl);

      expect(bidResponse.meta).to.be.an('object');
      expect(bidResponse.meta.mediaType).to.equal(BANNER);
      expect(bidResponse.meta.primaryCatId).to.equal('IAB18-5');
      // expect(bidResponse.meta.secondaryCatIds).to.deep.equal(['IAB8']);
      expect(bidResponse.meta.advertiserDomains).to.deep.equal(bid.adomain);
      expect(bidResponse.meta.clickUrl).to.equal(bid.adomain[0]);

      expect(bidResponse.ad).to.equal(bid.adm);
      expect(bidResponse.width).to.equal(bid.w);
      expect(bidResponse.height).to.equal(bid.h);
    });
  });
});
